<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A2P 10DLC Business Verification | RinglyPro</title>
    <style>
        :root {
            --primary-color: #0263e0;
            --primary-hover: #0150b5;
            --secondary-color: #0cce6b;
            --danger-color: #cc1421;
            --warning-color: #e46216;
            --bg-color: #f4f4f6;
            --card-bg: #ffffff;
            --text-primary: #121c2d;
            --text-secondary: #606b85;
            --border-color: #e1e3e9;
            --success-bg: #d5f5e3;
            --warning-bg: #fff3cd;
            --error-bg: #fce4e4;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: #ffffff;
            color: var(--text-primary);
            padding: 32px 24px;
            text-align: left;
            margin-bottom: 24px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .header p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Progress Indicator */
        .progress-indicator {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .progress-step {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--card-bg);
            border-radius: 20px;
            font-size: 0.875rem;
            border: 1px solid var(--border-color);
        }

        .progress-step.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .progress-step.completed {
            background: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-draft { background: var(--warning-bg); color: var(--warning-color); }
        .status-submitted { background: #dbeafe; color: #2563eb; }
        .status-approved { background: var(--success-bg); color: var(--secondary-color); }
        .status-rejected { background: var(--error-bg); color: var(--danger-color); }

        /* Error State */
        .error-container {
            background: var(--error-bg);
            border: 1px solid var(--danger-color);
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            margin: 50px auto;
            max-width: 500px;
        }

        .error-container h2 {
            color: var(--danger-color);
            margin-bottom: 10px;
        }

        /* Form Sections */
        .form-section {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 16px;
            border: 1px solid var(--border-color);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
        }

        .form-section h2 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-primary);
        }

        .form-section h2 .section-number {
            display: inline-flex;
            width: 24px;
            height: 24px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 10px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 6px;
            color: var(--text-primary);
        }

        .form-group label .required {
            color: var(--danger-color);
            margin-left: 2px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 0.875rem;
            transition: border-color 0.2s, box-shadow 0.2s;
            background-color: #ffffff;
            color: var(--text-primary);
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: #8891a4;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(2, 99, 224, 0.15);
        }

        .form-group input.error,
        .form-group select.error,
        .form-group textarea.error {
            border-color: var(--danger-color);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-group .help-text {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .form-group .error-text {
            font-size: 0.75rem;
            color: var(--danger-color);
            margin-top: 4px;
            display: none;
        }

        .form-group .error-text.visible {
            display: block;
        }

        /* Checkboxes */
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            background: var(--bg-color);
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .checkbox-item:hover {
            background: var(--border-color);
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-item.checked {
            background: rgba(2, 99, 224, 0.08);
            border: 1px solid var(--primary-color);
        }

        /* Single Checkbox */
        .single-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 16px;
            background: var(--bg-color);
            border-radius: 8px;
            margin-top: 16px;
        }

        .single-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-top: 2px;
            cursor: pointer;
        }

        .single-checkbox label {
            cursor: pointer;
            font-weight: normal;
        }

        /* Buttons */
        .button-group {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 4px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.15s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            letter-spacing: 0.025em;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-hover);
            box-shadow: 0 2px 4px rgba(2, 99, 224, 0.25);
        }

        .btn-secondary {
            background: #ffffff;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--bg-color);
            border-color: #c8cdd7;
        }

        .btn-success {
            background: var(--primary-color);
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background: var(--primary-hover);
            box-shadow: 0 2px 4px rgba(2, 99, 224, 0.25);
        }

        /* Messages */
        .message {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .message.visible {
            display: block;
        }

        .message.success {
            background: var(--success-bg);
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .message.error {
            background: var(--error-bg);
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .message.warning {
            background: var(--warning-bg);
            color: #92400e;
            border: 1px solid #fde68a;
        }

        .message ul {
            margin: 8px 0 0 20px;
        }

        /* Loading */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .loading.visible {
            display: flex;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Read-only state */
        .form-section.readonly input,
        .form-section.readonly select,
        .form-section.readonly textarea {
            background: var(--bg-color);
            cursor: not-allowed;
        }

        .form-section.readonly .checkbox-item {
            pointer-events: none;
            opacity: 0.7;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }

            .header {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .form-section {
                padding: 16px;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <div class="container">
        <!-- Error state (no clientId) -->
        <div class="error-container" id="errorContainer" style="display: none;">
            <h2>Missing Client ID</h2>
            <p>Please access this page with a valid client ID.</p>
            <p style="margin-top: 10px; font-size: 0.875rem; color: var(--text-secondary);">
                Example: /a2p?clientId=123
            </p>
        </div>

        <!-- Main form container -->
        <div id="formContainer" style="display: none;">
            <div class="header">
                <h1>A2P 10DLC Business Verification</h1>
                <p>SMS Enablement for <span id="businessName">Your Business</span></p>
            </div>

            <!-- Progress Indicator -->
            <div class="progress-indicator">
                <div class="progress-step" id="progressStatus">
                    <span>Status:</span>
                    <span class="status-badge status-draft" id="statusBadge">DRAFT</span>
                </div>
            </div>

            <!-- Messages -->
            <div class="message success" id="successMessage"></div>
            <div class="message error" id="errorMessage"></div>
            <div class="message warning" id="warningMessage"></div>

            <!-- Rejection Banner -->
            <div class="message error" id="rejectionBanner" style="display: none;">
                <strong>Application Rejected</strong>
                <p id="rejectionReason"></p>
            </div>

            <form id="a2pForm" novalidate>
                <!-- Section 1: Business Identity -->
                <div class="form-section" id="section1">
                    <h2><span class="section-number">1</span> Business Identity</h2>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="legalBusinessName">Legal Business Name <span class="required">*</span></label>
                            <input type="text" id="legalBusinessName" name="legalBusinessName" required>
                            <span class="error-text">Please enter your legal business name</span>
                        </div>
                        <div class="form-group">
                            <label for="dbaName">DBA Name (if different)</label>
                            <input type="text" id="dbaName" name="dbaName">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="businessType">Business Type <span class="required">*</span></label>
                            <select id="businessType" name="businessType" required>
                                <option value="">Select business type...</option>
                                <option value="LLC">LLC</option>
                                <option value="Corporation">Corporation</option>
                                <option value="Sole Proprietor">Sole Proprietor</option>
                                <option value="Partnership">Partnership</option>
                                <option value="Non-profit">Non-profit</option>
                                <option value="Government">Government</option>
                                <option value="Other">Other</option>
                            </select>
                            <span class="error-text">Please select your business type</span>
                        </div>
                        <div class="form-group">
                            <label for="companyType">Company Type <span class="required">*</span></label>
                            <select id="companyType" name="companyType" required>
                                <option value="">Select company type...</option>
                                <option value="private">Private</option>
                                <option value="public">Public (Stock Exchange Listed)</option>
                                <option value="non_profit">Non-Profit</option>
                                <option value="government">Government</option>
                            </select>
                            <span class="error-text">Please select company type</span>
                        </div>
                    </div>

                    <div class="form-row" id="stockInfoRow" style="display: none;">
                        <div class="form-group">
                            <label for="stockExchange">Stock Exchange <span class="required">*</span></label>
                            <select id="stockExchange" name="stockExchange">
                                <option value="">Select exchange...</option>
                                <option value="NYSE">NYSE</option>
                                <option value="NASDAQ">NASDAQ</option>
                                <option value="AMEX">AMEX</option>
                                <option value="TSX">TSX (Toronto)</option>
                                <option value="LSE">LSE (London)</option>
                                <option value="OTHER">Other</option>
                            </select>
                            <span class="error-text">Stock exchange is required for public companies</span>
                        </div>
                        <div class="form-group">
                            <label for="stockTicker">Stock Ticker Symbol <span class="required">*</span></label>
                            <input type="text" id="stockTicker" name="stockTicker" placeholder="e.g., AAPL" maxlength="10">
                            <span class="error-text">Stock ticker is required for public companies</span>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="businessVertical">Business Industry <span class="required">*</span></label>
                            <select id="businessVertical" name="businessVertical" required>
                                <option value="">Select industry...</option>
                                <option value="AGRICULTURE">Agriculture</option>
                                <option value="AUTOMOTIVE">Automotive</option>
                                <option value="BANKING">Banking/Financial</option>
                                <option value="CONSTRUCTION">Construction</option>
                                <option value="CONSUMER">Consumer Services</option>
                                <option value="EDUCATION">Education</option>
                                <option value="ENERGY">Energy/Utilities</option>
                                <option value="ENTERTAINMENT">Entertainment</option>
                                <option value="GOVERNMENT">Government</option>
                                <option value="HEALTHCARE">Healthcare</option>
                                <option value="HOSPITALITY">Hospitality</option>
                                <option value="INSURANCE">Insurance</option>
                                <option value="LEGAL">Legal</option>
                                <option value="MANUFACTURING">Manufacturing</option>
                                <option value="NOT_FOR_PROFIT">Not for Profit</option>
                                <option value="REAL_ESTATE">Real Estate</option>
                                <option value="RETAIL">Retail</option>
                                <option value="TECHNOLOGY">Technology</option>
                                <option value="TRANSPORTATION">Transportation</option>
                                <option value="OTHER">Other</option>
                            </select>
                            <span class="error-text">Please select business industry</span>
                        </div>
                        <div class="form-group">
                            <label for="regionsOfOperation">Regions of Operation <span class="required">*</span></label>
                            <select id="regionsOfOperation" name="regionsOfOperation" required>
                                <option value="">Select region...</option>
                                <option value="US_ONLY">United States Only</option>
                                <option value="US_AND_CANADA">US and Canada</option>
                                <option value="INTERNATIONAL">International</option>
                            </select>
                            <span class="error-text">Please select regions of operation</span>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="taxIdType">Business Registration ID Type <span class="required">*</span></label>
                            <select id="taxIdType" name="taxIdType" required>
                                <option value="">Select...</option>
                                <option value="EIN">EIN (Employer Identification Number)</option>
                                <option value="DUNS">DUNS Number</option>
                                <option value="GIIN">GIIN (Global Intermediary ID)</option>
                                <option value="LEI">LEI (Legal Entity Identifier)</option>
                                <option value="CBN">CBN (Canadian Business Number)</option>
                                <option value="OTHER">Other Tax ID</option>
                            </select>
                            <span class="help-text">US businesses typically use EIN</span>
                            <span class="error-text">Please select registration ID type</span>
                        </div>
                        <div class="form-group">
                            <label for="taxIdNumber">Business Registration Number <span class="required">*</span></label>
                            <input type="text" id="taxIdNumber" name="taxIdNumber" placeholder="XX-XXXXXXX" required>
                            <span class="help-text">Enter full EIN (XX-XXXXXXX) - must match IRS records exactly</span>
                            <span class="error-text">Please enter your full registration number</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="businessAddressLine1">Business Address <span class="required">*</span></label>
                        <input type="text" id="businessAddressLine1" name="businessAddressLine1" placeholder="Street address" required>
                        <span class="error-text">Please enter your business address</span>
                    </div>

                    <div class="form-group">
                        <label for="businessAddressLine2">Address Line 2</label>
                        <input type="text" id="businessAddressLine2" name="businessAddressLine2" placeholder="Suite, unit, floor, etc.">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="businessCity">City <span class="required">*</span></label>
                            <input type="text" id="businessCity" name="businessCity" required>
                            <span class="error-text">Please enter city</span>
                        </div>
                        <div class="form-group">
                            <label for="businessState">State <span class="required">*</span></label>
                            <input type="text" id="businessState" name="businessState" placeholder="e.g., CA, NY, TX" required>
                            <span class="error-text">Please enter state</span>
                        </div>
                        <div class="form-group">
                            <label for="businessPostalCode">ZIP Code <span class="required">*</span></label>
                            <input type="text" id="businessPostalCode" name="businessPostalCode" required>
                            <span class="error-text">Please enter ZIP code</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="businessWebsite">Business Website <span class="required">*</span></label>
                        <input type="url" id="businessWebsite" name="businessWebsite" placeholder="https://www.example.com" required>
                        <span class="error-text">Please enter a valid website URL (https://...)</span>
                    </div>
                </div>

                <!-- Section 2: Authorized Representative -->
                <div class="form-section" id="section2">
                    <h2><span class="section-number">2</span> Authorized Representative</h2>
                    <p style="margin-bottom: 16px; color: var(--text-secondary);">
                        This person must be authorized to represent the business and will receive verification emails.
                    </p>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="authorizedRepFirstName">First Name <span class="required">*</span></label>
                            <input type="text" id="authorizedRepFirstName" name="authorizedRepFirstName" required>
                            <span class="error-text">Please enter first name</span>
                        </div>
                        <div class="form-group">
                            <label for="authorizedRepLastName">Last Name <span class="required">*</span></label>
                            <input type="text" id="authorizedRepLastName" name="authorizedRepLastName" required>
                            <span class="error-text">Please enter last name</span>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="authorizedRepEmail">Representative Email <span class="required">*</span></label>
                            <input type="email" id="authorizedRepEmail" name="authorizedRepEmail" required>
                            <span class="help-text">Personal email for this representative</span>
                            <span class="error-text">Please enter a valid email address</span>
                        </div>
                        <div class="form-group">
                            <label for="businessContactEmail">Business Contact Email <span class="required">*</span></label>
                            <input type="email" id="businessContactEmail" name="businessContactEmail" required>
                            <span class="help-text">Company email for OTP verification (e.g., info@company.com)</span>
                            <span class="error-text">Please enter a valid business email</span>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="authorizedRepPhoneE164">Phone Number <span class="required">*</span></label>
                            <input type="tel" id="authorizedRepPhoneE164" name="authorizedRepPhoneE164" placeholder="+15551234567" required>
                            <span class="help-text">Format: +1XXXXXXXXXX (E.164)</span>
                            <span class="error-text">Please enter phone in E.164 format (+15551234567)</span>
                        </div>
                        <div class="form-group">
                            <label for="authorizedRepTitle">Job Title <span class="required">*</span></label>
                            <input type="text" id="authorizedRepTitle" name="authorizedRepTitle" placeholder="e.g., Owner, Marketing Director" required>
                            <span class="error-text">Please enter job title</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="jobPosition">Job Position <span class="required">*</span></label>
                        <select id="jobPosition" name="jobPosition" required>
                            <option value="">Select position...</option>
                            <option value="CEO">CEO / Owner</option>
                            <option value="CFO">CFO</option>
                            <option value="COO">COO</option>
                            <option value="CTO">CTO</option>
                            <option value="CMO">CMO</option>
                            <option value="VP">Vice President</option>
                            <option value="DIRECTOR">Director</option>
                            <option value="GM">General Manager</option>
                            <option value="MANAGER">Manager</option>
                            <option value="OTHER">Other</option>
                        </select>
                        <span class="error-text">Please select job position</span>
                    </div>
                </div>

                <!-- Section 3: Messaging Use Case -->
                <div class="form-section" id="section3">
                    <h2><span class="section-number">3</span> Messaging Use Case</h2>

                    <div class="form-group">
                        <label for="campaignUseCase">Primary Campaign Use Case <span class="required">*</span></label>
                        <select id="campaignUseCase" name="campaignUseCase" required>
                            <option value="">Select use case...</option>
                            <option value="CUSTOMER_CARE">Customer Care - Support messages</option>
                            <option value="ACCOUNT_NOTIFICATION">Account Notifications - Alerts and updates</option>
                            <option value="DELIVERY_NOTIFICATION">Delivery Notifications - Order/shipping updates</option>
                            <option value="FRAUD_ALERT">Fraud Alerts - Security notifications</option>
                            <option value="2FA">2FA / OTP - Authentication codes</option>
                            <option value="MARKETING">Marketing - Promotional messages</option>
                            <option value="MIXED">Mixed - Multiple purposes</option>
                            <option value="LOW_VOLUME">Low Volume Mixed - Under 6,000/day</option>
                        </select>
                        <span class="help-text">Select the primary purpose of your SMS messages</span>
                        <span class="error-text">Please select a campaign use case</span>
                    </div>

                    <div class="form-group">
                        <label>Additional Use Cases (select all that apply)</label>
                        <div class="checkbox-group" id="useCaseCategories">
                            <label class="checkbox-item">
                                <input type="checkbox" name="useCaseCategories" value="missed_call_followups">
                                <span>Missed Call Follow-ups</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="useCaseCategories" value="appointment_reminders">
                                <span>Appointment Reminders</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="useCaseCategories" value="appointment_scheduling">
                                <span>Appointment Scheduling</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="useCaseCategories" value="customer_care">
                                <span>Customer Care</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="useCaseCategories" value="lead_response">
                                <span>Lead Response</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="useCaseCategories" value="other">
                                <span>Other</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group" id="useCaseOtherGroup" style="display: none;">
                        <label for="useCaseOtherDescription">Describe your "Other" use case</label>
                        <input type="text" id="useCaseOtherDescription" name="useCaseOtherDescription">
                    </div>

                    <div class="form-group">
                        <label for="useCaseDescription">Detailed Use Case Description <span class="required">*</span></label>
                        <textarea id="useCaseDescription" name="useCaseDescription"
                            placeholder="Example: We send SMS to clients who have opted in via our website. Messages include appointment reminders 24 hours before scheduled visits, follow-ups for missed calls during business hours, and responses to customer service inquiries. Recipients are existing customers and leads who request information." required></textarea>
                        <span class="help-text">Explain WHO receives messages, WHAT type of content, and WHEN/WHY they're sent</span>
                        <span class="error-text">Please describe your SMS use case</span>
                    </div>

                    <div class="form-group">
                        <label>Message Content Attributes <span class="required">*</span></label>
                        <p style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 12px;">
                            Check all that apply to your message content:
                        </p>
                        <div class="checkbox-group" id="contentAttributes">
                            <label class="checkbox-item">
                                <input type="checkbox" name="contentAttributes" value="embedded_links">
                                <span>Embedded Links (URLs)</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="contentAttributes" value="embedded_phone">
                                <span>Embedded Phone Numbers</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="contentAttributes" value="age_gated">
                                <span>Age-Gated Content (21+)</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="contentAttributes" value="loan_lending">
                                <span>Loan/Lending Content</span>
                            </label>
                        </div>
                        <span class="help-text">Be honest - incorrect declarations can lead to campaign rejection</span>
                    </div>
                </div>

                <!-- Section 4: Consent & Compliance -->
                <div class="form-section" id="section4">
                    <h2><span class="section-number">4</span> Consent & Compliance</h2>

                    <div class="form-group">
                        <label>How do you obtain consent to send SMS? <span class="required">*</span></label>
                        <div class="checkbox-group" id="consentMethods">
                            <label class="checkbox-item">
                                <input type="checkbox" name="consentMethods" value="inbound_text_or_call">
                                <span>Inbound Text or Call</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="consentMethods" value="web_form">
                                <span>Web Form</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="consentMethods" value="existing_customer">
                                <span>Existing Customer Relationship</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="consentMethods" value="verbal_consent">
                                <span>Verbal Consent</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="consentMethods" value="paper_form">
                                <span>Paper Form</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="consentMethods" value="other">
                                <span>Other</span>
                            </label>
                        </div>
                        <span class="error-text">Please select at least one consent method</span>
                    </div>

                    <div class="form-group" id="consentOtherGroup" style="display: none;">
                        <label for="consentOtherDescription">Describe your "Other" consent method</label>
                        <input type="text" id="consentOtherDescription" name="consentOtherDescription">
                    </div>

                    <div class="form-group">
                        <label for="consentProcessDescription">Consent Process Description <span class="required">*</span></label>
                        <textarea id="consentProcessDescription" name="consentProcessDescription"
                            placeholder="Example: Customers provide consent by checking an optional SMS opt-in checkbox on our website contact form. The checkbox is not pre-selected. They can also opt-in by texting our business number first, or by verbally agreeing during a phone call." required></textarea>
                        <span class="help-text">Explain how customers explicitly agree to receive SMS from you</span>
                        <span class="error-text">Please describe your consent process</span>
                    </div>

                    <div class="form-group">
                        <label for="optInConfirmationMessage">Opt-in Confirmation Message <span class="required">*</span></label>
                        <textarea id="optInConfirmationMessage" name="optInConfirmationMessage"
                            placeholder="Example: Thanks for opting in to SMS from [Business Name]! You'll receive appointment reminders and service updates. Msg frequency varies. Msg & data rates may apply. Reply HELP for help, STOP to cancel." required></textarea>
                        <span class="help-text">The message sent to confirm SMS opt-in. Must include: business name, message type, frequency, rates disclaimer, HELP & STOP instructions</span>
                        <span class="error-text">Please provide your opt-in confirmation message</span>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="messageFrequency">Message Frequency <span class="required">*</span></label>
                            <select id="messageFrequency" name="messageFrequency" required>
                                <option value="">Select frequency...</option>
                                <option value="varies">Message frequency varies</option>
                                <option value="1_per_week">Up to 1 message per week</option>
                                <option value="2_4_per_month">2-4 messages per month</option>
                                <option value="1_per_day">Up to 1 message per day</option>
                                <option value="multiple_per_day">Multiple messages per day</option>
                            </select>
                            <span class="error-text">Please select message frequency</span>
                        </div>
                        <div class="form-group">
                            <label for="helpKeywordResponse">HELP Keyword Response <span class="required">*</span></label>
                            <input type="text" id="helpKeywordResponse" name="helpKeywordResponse"
                                placeholder="For help, contact support@company.com or call (555) 123-4567" required>
                            <span class="help-text">What users see when they text HELP</span>
                            <span class="error-text">Please provide HELP response</span>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="optInDisclosureUrl">Opt-in Disclosure URL</label>
                            <input type="url" id="optInDisclosureUrl" name="optInDisclosureUrl" placeholder="https://...">
                            <span class="help-text">Link to your SMS terms/consent page (recommended)</span>
                        </div>
                        <div class="form-group">
                            <label for="privacyPolicyUrl">Privacy Policy URL <span class="required">*</span></label>
                            <input type="url" id="privacyPolicyUrl" name="privacyPolicyUrl" placeholder="https://..." required>
                            <span class="help-text">Must state you don't share mobile info with third parties for marketing</span>
                            <span class="error-text">Privacy policy URL is required</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="termsOfServiceUrl">Terms of Service URL <span class="required">*</span></label>
                        <input type="url" id="termsOfServiceUrl" name="termsOfServiceUrl" placeholder="https://..." required>
                        <span class="help-text">Must include: program description, STOP/HELP instructions, carrier disclaimer, rates notice</span>
                        <span class="error-text">Terms of service URL is required</span>
                    </div>

                    <div class="single-checkbox">
                        <input type="checkbox" id="optOutAcknowledged" name="optOutAcknowledged">
                        <label for="optOutAcknowledged">
                            <strong>I acknowledge that:</strong>
                            <ul style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 8px;">
                                <li>SMS messages will include STOP opt-out instructions</li>
                                <li>Recipients can reply STOP to unsubscribe at any time</li>
                                <li>Consent checkboxes are optional and NOT pre-selected</li>
                                <li>We do NOT share mobile information with third parties for marketing</li>
                            </ul>
                        </label>
                    </div>
                    <span class="error-text" id="optOutError">You must acknowledge these compliance requirements</span>
                </div>

                <!-- Section 5: Sample Messages -->
                <div class="form-section" id="section5">
                    <h2><span class="section-number">5</span> Sample Messages</h2>
                    <div style="background: #eff6ff; border: 1px solid #bfdbfe; border-left: 4px solid var(--primary-color); border-radius: 4px; padding: 16px; margin-bottom: 20px;">
                        <strong style="color: var(--primary-color);">Sample Message Requirements:</strong>
                        <ul style="font-size: 0.875rem; color: var(--text-secondary); margin: 8px 0 0 20px;">
                            <li>Include your <strong>business name</strong> in messages</li>
                            <li>Use placeholders like [Customer Name] instead of real names</li>
                            <li>At least one message must include <strong>"Reply STOP to unsubscribe"</strong></li>
                            <li>Do NOT include personal information (real names, phone numbers, addresses)</li>
                            <li>Messages should match your declared use cases</li>
                        </ul>
                    </div>

                    <div class="form-group">
                        <label for="sampleMessage1">Sample Message 1 <span class="required">*</span></label>
                        <textarea id="sampleMessage1" name="sampleMessage1"
                            placeholder="Example: Hi [Customer Name], this is [Business Name]. Your appointment is confirmed for tomorrow at 2:00 PM. Reply STOP to opt out." required></textarea>
                        <span class="error-text">Please provide at least one sample message</span>
                    </div>

                    <div class="form-group">
                        <label for="sampleMessage2">Sample Message 2 <span class="required">*</span></label>
                        <textarea id="sampleMessage2" name="sampleMessage2"
                            placeholder="Example: [Business Name]: We missed your call! How can we help you today? Reply STOP to unsubscribe." required></textarea>
                        <span class="error-text">Please provide a second sample message</span>
                    </div>

                    <div class="form-group">
                        <label for="sampleMessage3">Sample Message 3</label>
                        <textarea id="sampleMessage3" name="sampleMessage3"
                            placeholder="Example: Thanks for choosing [Business Name]! Your service is scheduled for [Date]. Questions? Call us at [Business Phone]. Msg & data rates may apply."></textarea>
                    </div>

                    <div class="message warning" id="stopWarning" style="display: block;">
                        <strong>Required:</strong> At least one sample message must include "Reply STOP to unsubscribe" or similar opt-out language.
                    </div>
                </div>

                <!-- Section 6: Volume Estimates -->
                <div class="form-section" id="section6">
                    <h2><span class="section-number">6</span> Volume Estimates</h2>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="estimatedSmsPerDay">Expected SMS Volume per Day <span class="required">*</span></label>
                            <select id="estimatedSmsPerDay" name="estimatedSmsPerDay" required>
                                <option value="">Select volume...</option>
                                <option value="under_50">Under 50 messages</option>
                                <option value="50_200">50 - 200 messages</option>
                                <option value="200_1000">200 - 1,000 messages</option>
                                <option value="over_1000">Over 1,000 messages</option>
                            </select>
                            <span class="error-text">Please select expected volume</span>
                        </div>
                        <div class="form-group">
                            <label for="estimatedSmsPerMonth">Estimated Monthly Volume</label>
                            <input type="number" id="estimatedSmsPerMonth" name="estimatedSmsPerMonth" placeholder="e.g., 500" min="0">
                            <span class="help-text">Optional: approximate number per month</span>
                        </div>
                    </div>
                </div>

                <!-- Section 7: Review & Submit -->
                <div class="form-section" id="section7">
                    <h2><span class="section-number">7</span> Review & Submit</h2>
                    <p style="margin-bottom: 16px;">
                        Please review all information above before submitting. Once submitted, your application will be reviewed for A2P 10DLC verification.
                    </p>

                    <div class="button-group">
                        <button type="button" class="btn btn-secondary" id="saveDraftBtn">
                            Save Draft
                        </button>
                        <button type="submit" class="btn btn-success" id="submitBtn">
                            Submit for Verification
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ========================
        // Configuration
        // ========================
        const API_BASE = '/api';
        let clientId = null;
        let currentStatus = 'draft';
        let isReadOnly = false;

        // ========================
        // Initialize
        // ========================
        document.addEventListener('DOMContentLoaded', async () => {
            // Get clientId from URL
            const urlParams = new URLSearchParams(window.location.search);
            clientId = urlParams.get('clientId');

            if (!clientId) {
                showError();
                return;
            }

            showLoading(true);

            try {
                // Fetch existing A2P record
                const response = await fetch(`${API_BASE}/clients/${clientId}/a2p`);

                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        populateForm(result.data);
                        if (result.client) {
                            document.getElementById('businessName').textContent = result.client.businessName || 'Your Business';
                        }
                    }
                } else if (response.status === 404) {
                    // No existing record - that's ok, show empty form
                    console.log('No existing A2P record, starting fresh');
                } else {
                    throw new Error('Failed to load A2P data');
                }

                document.getElementById('formContainer').style.display = 'block';
            } catch (error) {
                console.error('Error loading A2P data:', error);
                showMessage('error', 'Failed to load A2P data. Please try again.');
                document.getElementById('formContainer').style.display = 'block';
            } finally {
                showLoading(false);
            }

            // Set up event listeners
            setupEventListeners();
        });

        // ========================
        // UI Functions
        // ========================
        function showError() {
            document.getElementById('errorContainer').style.display = 'block';
            document.getElementById('formContainer').style.display = 'none';
        }

        function showLoading(show) {
            document.getElementById('loading').classList.toggle('visible', show);
        }

        function showMessage(type, message, list = []) {
            // Hide all messages first
            ['success', 'error', 'warning'].forEach(t => {
                document.getElementById(`${t}Message`).classList.remove('visible');
            });

            const el = document.getElementById(`${type}Message`);
            let html = message;
            if (list.length > 0) {
                html += '<ul>' + list.map(item => `<li>${item}</li>`).join('') + '</ul>';
            }
            el.innerHTML = html;
            el.classList.add('visible');

            // Scroll to message
            el.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function hideMessages() {
            ['success', 'error', 'warning'].forEach(t => {
                document.getElementById(`${t}Message`).classList.remove('visible');
            });
        }

        function updateStatus(status) {
            currentStatus = status;
            const badge = document.getElementById('statusBadge');
            badge.textContent = status.toUpperCase();
            badge.className = `status-badge status-${status}`;

            // Set read-only mode for non-draft status
            isReadOnly = status !== 'draft';
            setFormReadOnly(isReadOnly);
        }

        function setFormReadOnly(readonly) {
            const form = document.getElementById('a2pForm');
            const inputs = form.querySelectorAll('input, select, textarea');
            const sections = form.querySelectorAll('.form-section');

            inputs.forEach(input => {
                if (readonly) {
                    input.setAttribute('disabled', 'disabled');
                } else {
                    input.removeAttribute('disabled');
                }
            });

            sections.forEach(section => {
                section.classList.toggle('readonly', readonly);
            });

            // Hide buttons if readonly
            document.getElementById('saveDraftBtn').style.display = readonly ? 'none' : 'inline-flex';
            document.getElementById('submitBtn').style.display = readonly ? 'none' : 'inline-flex';
        }

        // ========================
        // Form Population
        // ========================
        function populateForm(data) {
            if (!data) return;

            // Update status
            if (data.status) {
                updateStatus(data.status);
            }

            // Show rejection banner if rejected
            if (data.status === 'rejected' && data.rejectionReason) {
                document.getElementById('rejectionBanner').style.display = 'block';
                document.getElementById('rejectionReason').textContent = data.rejectionReason;
            }

            // Populate text fields
            const textFields = [
                'legalBusinessName', 'dbaName', 'businessType', 'companyType', 'businessVertical',
                'regionsOfOperation', 'stockExchange', 'stockTicker',
                'taxIdType', 'taxIdNumber', 'businessAddressLine1', 'businessAddressLine2',
                'businessCity', 'businessState', 'businessPostalCode', 'businessWebsite',
                'authorizedRepFirstName', 'authorizedRepLastName', 'authorizedRepEmail',
                'businessContactEmail', 'authorizedRepPhoneE164', 'authorizedRepTitle', 'jobPosition',
                'campaignUseCase', 'useCaseOtherDescription', 'useCaseDescription',
                'consentProcessDescription', 'optInConfirmationMessage', 'messageFrequency', 'helpKeywordResponse',
                'consentOtherDescription', 'optInDisclosureUrl', 'privacyPolicyUrl', 'termsOfServiceUrl',
                'sampleMessage1', 'sampleMessage2', 'sampleMessage3', 'estimatedSmsPerDay', 'estimatedSmsPerMonth'
            ];

            // Show stock info if public company
            if (data.companyType === 'public') {
                document.getElementById('stockInfoRow').style.display = 'flex';
            }

            textFields.forEach(field => {
                const el = document.getElementById(field);
                if (el && data[field] !== undefined && data[field] !== null) {
                    el.value = data[field];
                }
            });

            // Populate checkboxes
            if (data.useCaseCategories && Array.isArray(data.useCaseCategories)) {
                data.useCaseCategories.forEach(value => {
                    const checkbox = document.querySelector(`input[name="useCaseCategories"][value="${value}"]`);
                    if (checkbox) {
                        checkbox.checked = true;
                        checkbox.closest('.checkbox-item').classList.add('checked');
                    }
                });
                // Show "other" field if selected
                if (data.useCaseCategories.includes('other')) {
                    document.getElementById('useCaseOtherGroup').style.display = 'block';
                }
            }

            if (data.consentMethods && Array.isArray(data.consentMethods)) {
                data.consentMethods.forEach(value => {
                    const checkbox = document.querySelector(`input[name="consentMethods"][value="${value}"]`);
                    if (checkbox) {
                        checkbox.checked = true;
                        checkbox.closest('.checkbox-item').classList.add('checked');
                    }
                });
                // Show "other" field if selected
                if (data.consentMethods.includes('other')) {
                    document.getElementById('consentOtherGroup').style.display = 'block';
                }
            }

            // Content attributes checkboxes
            if (data.contentAttributes && Array.isArray(data.contentAttributes)) {
                data.contentAttributes.forEach(value => {
                    const checkbox = document.querySelector(`input[name="contentAttributes"][value="${value}"]`);
                    if (checkbox) {
                        checkbox.checked = true;
                        checkbox.closest('.checkbox-item').classList.add('checked');
                    }
                });
            }

            // Opt-out checkbox
            if (data.optOutAcknowledged) {
                document.getElementById('optOutAcknowledged').checked = true;
            }

            // Check STOP language in sample messages
            checkStopLanguage();
        }

        // ========================
        // Form Submission
        // ========================
        function getFormData() {
            const form = document.getElementById('a2pForm');
            const formData = new FormData(form);
            const data = {};

            // Text fields
            const textFields = [
                'legalBusinessName', 'dbaName', 'businessType', 'companyType', 'businessVertical',
                'regionsOfOperation', 'stockExchange', 'stockTicker',
                'taxIdType', 'taxIdNumber', 'businessAddressLine1', 'businessAddressLine2',
                'businessCity', 'businessState', 'businessPostalCode', 'businessWebsite',
                'authorizedRepFirstName', 'authorizedRepLastName', 'authorizedRepEmail',
                'businessContactEmail', 'authorizedRepPhoneE164', 'authorizedRepTitle', 'jobPosition',
                'campaignUseCase', 'useCaseOtherDescription', 'useCaseDescription',
                'consentProcessDescription', 'optInConfirmationMessage', 'messageFrequency', 'helpKeywordResponse',
                'consentOtherDescription', 'optInDisclosureUrl', 'privacyPolicyUrl', 'termsOfServiceUrl',
                'sampleMessage1', 'sampleMessage2', 'sampleMessage3', 'estimatedSmsPerDay'
            ];

            textFields.forEach(field => {
                const el = document.getElementById(field);
                if (el) {
                    data[field] = el.value || null;
                }
            });

            // Numeric fields
            const monthlyVolume = document.getElementById('estimatedSmsPerMonth').value;
            data.estimatedSmsPerMonth = monthlyVolume ? parseInt(monthlyVolume) : null;

            // Checkbox arrays
            data.useCaseCategories = [];
            document.querySelectorAll('input[name="useCaseCategories"]:checked').forEach(cb => {
                data.useCaseCategories.push(cb.value);
            });

            data.consentMethods = [];
            document.querySelectorAll('input[name="consentMethods"]:checked').forEach(cb => {
                data.consentMethods.push(cb.value);
            });

            data.contentAttributes = [];
            document.querySelectorAll('input[name="contentAttributes"]:checked').forEach(cb => {
                data.contentAttributes.push(cb.value);
            });

            // Single checkbox
            data.optOutAcknowledged = document.getElementById('optOutAcknowledged').checked;

            return data;
        }

        async function saveDraft() {
            hideMessages();
            showLoading(true);

            try {
                const data = getFormData();

                const response = await fetch(`${API_BASE}/clients/${clientId}/a2p`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (result.success) {
                    showMessage('success', 'Draft saved successfully!');
                    if (result.data) {
                        updateStatus(result.data.status || 'draft');
                    }
                } else {
                    showMessage('error', 'Failed to save draft', result.errors || [result.error]);
                }
            } catch (error) {
                console.error('Error saving draft:', error);
                showMessage('error', 'Failed to save draft. Please try again.');
            } finally {
                showLoading(false);
            }
        }

        async function submitForm() {
            hideMessages();

            // Client-side validation
            const errors = validateForm();
            if (errors.length > 0) {
                showMessage('error', 'Please fix the following errors:', errors);
                return;
            }

            showLoading(true);

            try {
                // First save the current data
                const data = getFormData();
                const saveResponse = await fetch(`${API_BASE}/clients/${clientId}/a2p`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (!saveResponse.ok) {
                    const saveResult = await saveResponse.json();
                    throw new Error(saveResult.error || 'Failed to save data');
                }

                // Then submit
                const response = await fetch(`${API_BASE}/clients/${clientId}/a2p/submit`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const result = await response.json();

                if (result.success) {
                    let message = 'Your A2P application has been submitted for verification!';
                    if (result.warnings && result.warnings.length > 0) {
                        showMessage('warning', message + '<br><br>' + result.warnings.join('<br>'));
                    } else {
                        showMessage('success', message);
                    }
                    updateStatus('submitted');
                } else {
                    showMessage('error', result.message || 'Submission failed', result.errors || []);
                }
            } catch (error) {
                console.error('Error submitting form:', error);
                showMessage('error', 'Failed to submit. Please try again.');
            } finally {
                showLoading(false);
            }
        }

        // ========================
        // Validation
        // ========================
        function validateForm() {
            const errors = [];
            const data = getFormData();

            // Business Identity
            if (!data.legalBusinessName) errors.push('Legal business name is required');
            if (!data.businessType) errors.push('Business type is required');
            if (!data.companyType) errors.push('Company type is required');
            if (!data.businessVertical) errors.push('Business industry is required');
            if (!data.regionsOfOperation) errors.push('Regions of operation is required');
            if (!data.taxIdType) errors.push('Business registration ID type is required');
            if (!data.taxIdNumber) errors.push('Business registration number is required');
            // Validate EIN format (XX-XXXXXXX)
            if (data.taxIdType === 'EIN' && data.taxIdNumber && !/^\d{2}-?\d{7}$/.test(data.taxIdNumber)) {
                errors.push('EIN must be in format XX-XXXXXXX (9 digits)');
            }
            if (!data.businessAddressLine1) errors.push('Business address is required');
            if (!data.businessCity) errors.push('City is required');
            if (!data.businessState) errors.push('State is required');
            if (!data.businessPostalCode) errors.push('ZIP code is required');
            if (!data.businessWebsite) errors.push('Business website is required');
            if (data.businessWebsite && !isValidUrl(data.businessWebsite)) errors.push('Business website must be a valid URL');
            // Public company validation
            if (data.companyType === 'public') {
                if (!data.stockExchange) errors.push('Stock exchange is required for public companies');
                if (!data.stockTicker) errors.push('Stock ticker is required for public companies');
            }

            // Authorized Representative
            if (!data.authorizedRepFirstName) errors.push('Representative first name is required');
            if (!data.authorizedRepLastName) errors.push('Representative last name is required');
            if (!data.authorizedRepEmail) errors.push('Representative email is required');
            if (data.authorizedRepEmail && !isValidEmail(data.authorizedRepEmail)) errors.push('Invalid representative email format');
            if (!data.businessContactEmail) errors.push('Business contact email is required');
            if (data.businessContactEmail && !isValidEmail(data.businessContactEmail)) errors.push('Invalid business email format');
            if (!data.authorizedRepPhoneE164) errors.push('Representative phone is required');
            if (data.authorizedRepPhoneE164 && !isValidE164(data.authorizedRepPhoneE164)) errors.push('Phone must be in E.164 format (+15551234567)');
            if (!data.authorizedRepTitle) errors.push('Representative job title is required');
            if (!data.jobPosition) errors.push('Job position is required');

            // Use Case
            if (!data.campaignUseCase) errors.push('Primary campaign use case is required');
            if (!data.useCaseDescription) errors.push('Use case description is required');

            // Consent
            if (!data.consentMethods || data.consentMethods.length === 0) errors.push('At least one consent method is required');
            if (!data.consentProcessDescription) errors.push('Consent process description is required');
            if (!data.optInConfirmationMessage) errors.push('Opt-in confirmation message is required');
            if (!data.messageFrequency) errors.push('Message frequency is required');
            if (!data.helpKeywordResponse) errors.push('HELP keyword response is required');
            if (!data.privacyPolicyUrl) errors.push('Privacy policy URL is required');
            if (!data.termsOfServiceUrl) errors.push('Terms of service URL is required');
            if (!data.optOutAcknowledged) errors.push('Compliance acknowledgement is required');

            // Sample Messages
            if (!data.sampleMessage1) errors.push('Sample message 1 is required');
            if (!data.sampleMessage2) errors.push('Sample message 2 is required');

            // Volume
            if (!data.estimatedSmsPerDay) errors.push('Estimated SMS volume is required');

            // Validate URLs
            const urlFields = ['optInDisclosureUrl', 'privacyPolicyUrl', 'termsOfServiceUrl', 'businessWebsite'];
            urlFields.forEach(field => {
                if (data[field] && !isValidUrl(data[field])) {
                    errors.push(`${field.replace(/([A-Z])/g, ' $1').toLowerCase()} must be a valid URL`);
                }
            });

            // Mark invalid fields
            markInvalidFields(errors);

            return errors;
        }

        function markInvalidFields(errors) {
            // Clear previous errors
            document.querySelectorAll('.error').forEach(el => el.classList.remove('error'));
            document.querySelectorAll('.error-text').forEach(el => el.classList.remove('visible'));

            // Mark fields based on errors
            const fieldMap = {
                'Legal business name is required': 'legalBusinessName',
                'Business type is required': 'businessType',
                'Company type is required': 'companyType',
                'Business industry is required': 'businessVertical',
                'Regions of operation is required': 'regionsOfOperation',
                'Business registration ID type is required': 'taxIdType',
                'Business registration number is required': 'taxIdNumber',
                'EIN must be in format XX-XXXXXXX (9 digits)': 'taxIdNumber',
                'Stock exchange is required for public companies': 'stockExchange',
                'Stock ticker is required for public companies': 'stockTicker',
                'Business address is required': 'businessAddressLine1',
                'City is required': 'businessCity',
                'State is required': 'businessState',
                'ZIP code is required': 'businessPostalCode',
                'Business website is required': 'businessWebsite',
                'Business website must be a valid URL': 'businessWebsite',
                'Representative first name is required': 'authorizedRepFirstName',
                'Representative last name is required': 'authorizedRepLastName',
                'Representative email is required': 'authorizedRepEmail',
                'Invalid representative email format': 'authorizedRepEmail',
                'Business contact email is required': 'businessContactEmail',
                'Invalid business email format': 'businessContactEmail',
                'Representative phone is required': 'authorizedRepPhoneE164',
                'Phone must be in E.164 format (+15551234567)': 'authorizedRepPhoneE164',
                'Representative job title is required': 'authorizedRepTitle',
                'Job position is required': 'jobPosition',
                'Primary campaign use case is required': 'campaignUseCase',
                'Use case description is required': 'useCaseDescription',
                'Consent process description is required': 'consentProcessDescription',
                'Opt-in confirmation message is required': 'optInConfirmationMessage',
                'Message frequency is required': 'messageFrequency',
                'HELP keyword response is required': 'helpKeywordResponse',
                'Privacy policy URL is required': 'privacyPolicyUrl',
                'Terms of service URL is required': 'termsOfServiceUrl',
                'Sample message 1 is required': 'sampleMessage1',
                'Sample message 2 is required': 'sampleMessage2',
                'Estimated SMS volume is required': 'estimatedSmsPerDay'
            };

            errors.forEach(error => {
                const fieldId = fieldMap[error];
                if (fieldId) {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        field.classList.add('error');
                        const errorText = field.parentElement.querySelector('.error-text');
                        if (errorText) errorText.classList.add('visible');
                    }
                }
            });

            // Special handling for opt-out checkbox
            if (errors.includes('Compliance acknowledgement is required')) {
                document.getElementById('optOutError').classList.add('visible');
            }
        }

        // ========================
        // Validation Helpers
        // ========================
        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        function isValidUrl(url) {
            try {
                new URL(url);
                return url.startsWith('http://') || url.startsWith('https://');
            } catch {
                return false;
            }
        }

        function isValidE164(phone) {
            return /^\+[1-9]\d{1,14}$/.test(phone);
        }

        function checkStopLanguage() {
            const messages = [
                document.getElementById('sampleMessage1').value,
                document.getElementById('sampleMessage2').value,
                document.getElementById('sampleMessage3').value
            ].join(' ').toLowerCase();

            const hasStop = messages.includes('stop') ||
                           messages.includes('opt out') ||
                           messages.includes('unsubscribe') ||
                           messages.includes('text stop');

            document.getElementById('stopWarning').style.display = hasStop ? 'none' : 'block';
        }

        // ========================
        // Event Listeners
        // ========================
        function setupEventListeners() {
            // Form submission
            document.getElementById('a2pForm').addEventListener('submit', (e) => {
                e.preventDefault();
                submitForm();
            });

            // Save draft button
            document.getElementById('saveDraftBtn').addEventListener('click', saveDraft);

            // Checkbox styling
            document.querySelectorAll('.checkbox-item input[type="checkbox"]').forEach(cb => {
                cb.addEventListener('change', function() {
                    this.closest('.checkbox-item').classList.toggle('checked', this.checked);

                    // Handle "other" fields
                    if (this.value === 'other') {
                        const parent = this.closest('.form-group');
                        const isUseCase = this.name === 'useCaseCategories';
                        const otherGroup = document.getElementById(isUseCase ? 'useCaseOtherGroup' : 'consentOtherGroup');
                        otherGroup.style.display = this.checked ? 'block' : 'none';
                    }
                });
            });

            // Sample message STOP language check
            ['sampleMessage1', 'sampleMessage2', 'sampleMessage3'].forEach(id => {
                document.getElementById(id).addEventListener('input', checkStopLanguage);
            });

            // Phone number formatting
            document.getElementById('authorizedRepPhoneE164').addEventListener('blur', function() {
                let value = this.value.replace(/\D/g, '');
                if (value && !value.startsWith('+')) {
                    if (value.startsWith('1') && value.length === 11) {
                        this.value = '+' + value;
                    } else if (value.length === 10) {
                        this.value = '+1' + value;
                    }
                }
            });

            // EIN formatting (XX-XXXXXXX)
            document.getElementById('taxIdNumber').addEventListener('input', function() {
                let value = this.value.replace(/\D/g, '');
                if (value.length > 2) {
                    this.value = value.slice(0, 2) + '-' + value.slice(2, 9);
                } else {
                    this.value = value;
                }
            });

            // Show/hide stock info based on company type
            document.getElementById('companyType').addEventListener('change', function() {
                const stockRow = document.getElementById('stockInfoRow');
                stockRow.style.display = this.value === 'public' ? 'flex' : 'none';
            });

            // Clear errors on input
            document.querySelectorAll('input, select, textarea').forEach(el => {
                el.addEventListener('input', function() {
                    this.classList.remove('error');
                    const errorText = this.parentElement.querySelector('.error-text');
                    if (errorText) errorText.classList.remove('visible');
                });
            });
        }
    </script>
</body>
</html>
